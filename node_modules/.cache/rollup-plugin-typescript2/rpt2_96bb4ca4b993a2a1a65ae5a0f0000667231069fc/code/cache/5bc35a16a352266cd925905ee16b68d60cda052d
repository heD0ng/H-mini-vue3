{"code":"// import { isObject } from '@vue/shared';\r\nimport { isObject } from '../../shared/src/index';\r\nimport { componentPublicInstance } from './componentPublicInstance';\r\nimport { isFunction } from '../../shared/src/index';\r\nimport { effect } from '../../reactivity/src/effect';\r\nexport function mountComponent(vnode, container) {\r\n    var instance = vnode.component = createComponentInstance(vnode);\r\n    return instance;\r\n}\r\n// 创建组件实例\r\nexport function createComponentInstance(vnode) {\r\n    var instance = {\r\n        vnode: vnode,\r\n        type: {},\r\n        props: {},\r\n        attrs: {},\r\n        setupState: {},\r\n        ctx: {},\r\n        proxy: {},\r\n        // 判断是否是第一次加载\r\n        isMounted: false\r\n    };\r\n    instance.ctx = { _: instance };\r\n    return instance;\r\n}\r\n// 解析数据到组件中\r\nexport function setupComponent(instance) {\r\n    var _a = instance.vnode, props = _a.props, children = _a.children, type = _a.type;\r\n    instance.type = type;\r\n    instance.props = props;\r\n    instance.children = children;\r\n    var isStateFul = instance.vnode.shapeFlag & 4 /* ShapeFlags.STATEFUL_COMPONENT */;\r\n    if (isStateFul) {\r\n        setupStateComponent(instance);\r\n    }\r\n}\r\nfunction setupStateComponent(instance) {\r\n    var _a;\r\n    instance.proxy = new Proxy(instance.ctx, componentPublicInstance);\r\n    var setup = ((_a = instance === null || instance === void 0 ? void 0 : instance.type) === null || _a === void 0 ? void 0 : _a.setup) || null;\r\n    var context = createContext(instance);\r\n    if (setup) {\r\n        var res = setup(instance.props, context);\r\n        if (isObject(res)) {\r\n            instance.setupState = res;\r\n        }\r\n        else if (isFunction(res)) {\r\n            instance.render = res;\r\n        }\r\n        else {\r\n            return console.warn('the return value of setup should be a function or object!');\r\n        }\r\n    }\r\n    finishComponentSetup(instance);\r\n    // instance.render(instance.proxy);\r\n}\r\n// 数据改变重新触发render函数\r\nexport function setupRenderEffect(instance) {\r\n    effect(function () {\r\n        // 判断是不是第一次加载\r\n        if (!instance.isMounted) {\r\n            instance.render.call(instance.proxy, instance.proxy);\r\n        }\r\n    });\r\n}\r\nexport function createContext(instance) {\r\n    return {\r\n        props: instance.props,\r\n        slots: instance.slots,\r\n        emits: function () { },\r\n        attrs: instance.attrs,\r\n        expose: function () { }\r\n    };\r\n}\r\nfunction finishComponentSetup(instance) {\r\n    var Component = instance.vnode.component;\r\n    console.log(Component, instance, 5555);\r\n    if (!instance.render) {\r\n        if (!Component.render && Component.template) {\r\n            // 模板编译\r\n            // Component.render = \r\n        }\r\n        instance.render = Component.render;\r\n    }\r\n}\r\n//# sourceMappingURL=component.js.map","references":["D:/frontEnd/Vue3/mini-Vue3/packages/shared/src/index.ts","D:/frontEnd/Vue3/mini-Vue3/packages/runtime-core/src/componentPublicInstance.ts","D:/frontEnd/Vue3/mini-Vue3/packages/shared/src/shapeFlags.ts","D:/frontEnd/Vue3/mini-Vue3/packages/shared/src/index.ts","D:/frontEnd/Vue3/mini-Vue3/packages/reactivity/src/effect.ts"],"map":"{\"version\":3,\"file\":\"component.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/runtime-core/src/component.ts\"],\"names\":[],\"mappings\":\"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\"}"}
